<div class="container p-8 mx-auto">
  <h1 class="mb-6 text-3xl font-bold text-text-main dark:text-gray-100">Admin Panel - User Management</h1>

  <div *ngIf="users$ | async as users; else loading">
    <div *ngIf="currentUser$ | async as currentUser">
      <div class="overflow-x-auto bg-white dark:bg-primary-dark rounded-lg shadow">
        <table class="min-w-full text-sm divide-y-2 divide-gray-200 dark:divide-primary-light/10">
          <thead class="bg-gray-50 dark:bg-primary-dark/50">
            <tr>
              <th class="px-4 py-2 font-medium text-left text-gray-900 dark:text-gray-300 whitespace-nowrap">Email</th>
              <th class="px-4 py-2 font-medium text-left text-gray-900 dark:text-gray-300 whitespace-nowrap">Level</th>
              <th class="px-4 py-2 font-medium text-left text-gray-900 dark:text-gray-300 whitespace-nowrap">Role</th>
              <th class="px-4 py-2 font-medium text-left text-gray-900 dark:text-gray-300 whitespace-nowrap">Actions</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-200 dark:divide-primary-light/10">
            <tr *ngFor="let user of users" class="hover:bg-gray-50 dark:hover:bg-primary-light/5">
              <td class="px-4 py-2 font-medium text-gray-900 dark:text-gray-200 whitespace-nowrap">{{ user.email }}</td>
              <td class="px-4 py-2 text-gray-700 dark:text-gray-400 whitespace-nowrap">{{ user.level }}</td>
              <td class="px-4 py-2 text-gray-700 whitespace-nowrap">
                <select 
                  (change)="onRoleChange($event, user)"
                  [disabled]="user.id === currentUser?.id"
                  class="w-full p-1 bg-white dark:bg-primary-light/10 border-gray-300 dark:border-primary-light/20 rounded-md text-text-main dark:text-gray-200 focus:ring-primary focus:border-primary disabled:bg-gray-200 dark:disabled:bg-gray-700 disabled:cursor-not-allowed"
                >
                  <option 
                    *ngFor="let role of userRoles" 
                    [value]="role" 
                    [selected]="role === user.role"
                  >
                    {{ role }}
                  </option>
                </select>
              </td>
              <td class="px-4 py-2 whitespace-nowrap">
                <button 
                  *ngIf="user.id !== currentUser?.id" 
                  (click)="onDeleteUser(user.id)" 
                  class="px-3 py-1 text-sm font-medium text-white transition-colors rounded-md bg-red-600 hover:bg-red-700"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <ng-template #loading>
    <p class="text-text-secondary dark:text-gray-400">Loading users...</p>
  </ng-template>
</div>